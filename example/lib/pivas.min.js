var PV=PV||{};!function(){var global=this,defaults={lang:"en",descriptors:"/app/descriptors",locales:"/app/locales",modules:"/app/modules",templates:"/app/templates",views:"/app/views"};PV.namespace=function(){for(var j,parts,chunk,i=0;i<arguments.length;i++){parts=arguments[i].split("."),chunk=global;for(j in parts)chunk[parts[j]]=chunk[parts[j]]||{},chunk=chunk[parts[j]]}},PV.extend=function(){var key,i=1;if("object"==typeof arguments[0])for(;i<arguments.length;i++)if("object"==typeof arguments[i])for(key in arguments[i])arguments[0][key]||(arguments[0][key]=arguments[i][key]);return arguments[0]},PV.define=function(name,value){var i,parts=name.split("."),final_part=parts.pop(),chunk=global;for(i in parts)chunk[parts[i]]=chunk[parts[i]]||{},chunk=chunk[parts[i]];chunk[final_part]=value},PV.require=function(url,callback,context){var head,script;head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script"),script.type="text/javascript",script.async="async",script.src=url,head.appendChild(script),script.onload=script.onreadystatechange=function(){script.onload=script.onreadystatechange=null,head.removeChild(script),script=void 0,arguments[1]||callback.call(context||global)}},PV.multiload=function(urls,callback,context){var i,redystate=0,isReady=function(){redystate--,!redystate&&callback instanceof Function&&callback.call(context||global)};for(i=0;i<urls.length;i++)redystate++,PV.require(urls[i]+(urls[i].match(/\?/)?"&":"?")+"v="+PV.config.version,function(){isReady()})},PV.each=function(obj,callback,context){var i;if("object"==typeof obj){callback=callback instanceof Function?callback:function(){},context=context||this;for(i in obj)callback.call(context,i,obj[i])}},PV.Storage=function(){var list={};this.append=function(name,value){return list[name]=value,!0},this.get=function(name){return list[name]||!1},this.remove=function(name){return name in list&&delete list[name],!0}},PV.Locale=function(locale){var lang=PV.config.lang;this.getText=function(text){return locale[lang]&&locale[lang][text]?locale[lang][text]:text}},PV.Events=function(){var events={};this.on=function(event,handler){var exists=!1;events[event]||(events[event]=[]),PV.each(events[event],function(i,_handler){handler===_handler&&(exists=!0)},this),exists||events[event].push(handler)},this.trigger=function(event,data,context){events[event]instanceof Array&&(context=context||this,PV.each(events[event],function(i,handler){handler.call(context,data)},context))},this.unscribe=function(event,handler){events[event]instanceof Array&&PV.each(events[event],function(i,_handler){_handler===handler&&events[event].splice(i,1)},this)}},PV.Provider=new function(){var handlers={"import":{},"export":{}};this.register=function(args){var _import=args["import"]&&args["import"]instanceof Array?args["import"]:[],_export=args["export"]&&args["export"]instanceof Array?args["export"]:[];PV.each(_import,function(i,item){handlers["import"][item]||(handlers["import"][item]={}),handlers["import"][item][args.name]||(handlers["import"][item][args.name]=!0)},this),PV.each(_export,function(i,item){handlers["export"][item]||(handlers["export"][item]={}),handlers["export"][item][args.name]||(handlers["export"][item][args.name]=!0)},this)},this.unregister=function(moduleName){PV.each(handlers["export"],function(method,modules){modules[moduleName]&&delete modules[moduleName]},this),PV.each(handlers["import"],function(method,modules){modules[moduleName]&&delete modules[moduleName]},this)},this.deliver=function(source,method,args,context){context=context||global,(handlers["import"][method]&&handlers["import"][method][source]||handlers["import"]["*"]&&handlers["import"]["*"][source])&&handlers["export"][method]&&PV.each(handlers["export"][method],function(moduleName){var module=PV.Modules.Running.get(moduleName);module&&module.callMethod(method,args,source,context)},this)}},PV.Sandbox=function(environment,args){var locale,module,view,here=this,config=environment.config||{};if(args="object"==typeof args?args:{},!environment.module)throw new Error("Module not found");if(environment.locale&&(locale=new PV.Locale(environment.locale)),environment.view&&(environment.view.prototype={getText:function(text){return locale?locale.getText(text):""},events:new PV.Events},view=new environment.view(config),"function"!=typeof view.destroy))throw new Error('Not found method "destroy" in view');if(environment.module.prototype={view:view,getText:function(text){return locale?locale.getText(text):""},emit:function(event,data){PV.Provider.deliver(environment.name,event,data,this)},suicide:function(){here.destroy.call(here)},events:new PV.Events},module=new environment.module(config,args),"function"!=typeof module.destroy)throw new Error('Not found method "destroy" in module');if("function"!=typeof module.init)throw new Error('Not found method "init" in module');this.callMethod=function(method,data,source,context){context=context||module,module[method]instanceof Function&&module[method].apply(context,[data,source])},this.destroy=function(){module.destroy(),view&&view.destroy instanceof Function&&view.destroy(),PV.Provider.unregister(environment.name),PV.Modules.Running.remove(environment.name)},module.init()},PV.each(["PV.Descriptors.Storage","PV.Locales.Storage","PV.Modules.Storage","PV.Views.Storage","PV.Modules.Running"],function(i,name){PV.define(name,new PV.Storage)},global),PV.loaderFactory=function(name,storage,callback,cache){cache=cache!==!1,cache&&PV[storage].Storage.get(name)?callback.call(global):PV.require(PV.config[storage.toLowerCase()]+"/"+name+".js?"+(cache?"v="+PV.config.version:"r="+Math.random()),function(){PV[storage].Storage.get(name)&&callback.call(global)})},PV.factoryModule=function(name,args){return PV.Modules.Running.get(name)?!1:(PV.loaderFactory(name,"Descriptors",function(){var descriptor=PV.Descriptors.Storage.get(name),environment={name:name},readyState=0,entity={module:"Modules",locale:"Locales",view:"Views"},onReady=function(){PV.Provider.register({name:name,"import":environment["import"]||[],"export":environment["export"]||[]}),PV.Modules.Running.append(name,new PV.Sandbox(environment,args))},checkReadyState=function(){readyState--,readyState||onReady()};descriptor&&(PV.each(["export","import","config"],function(i,attribute){"undefined"!=typeof descriptor[attribute]&&(environment[attribute]=descriptor[attribute])},this),PV.each(entity,function(attribute){"string"==typeof descriptor[attribute]&&readyState++},this),PV.each(entity,function(attribute,storage){"string"==typeof descriptor[attribute]&&PV.loaderFactory(descriptor[attribute],storage,function(){var data=PV[storage].Storage.get(descriptor[attribute]);data&&(environment[attribute]=data,checkReadyState())})},this))},!1),!0)},PV.declare=function(name,entity,data){PV[entity+"s"].Storage.append(name,data)},PV.init=function(config){var onReady,preloadReady=!0;PV.namespace("PV.config"),PV.extend(PV.config,config,defaults),PV.config.preload instanceof Array&&(preloadReady=!1,PV.multiload(PV.config.preload,function(){preloadReady=!0,onReady instanceof Function&&onReady.call(global)})),PV.define("PV.ready",function(callback){preloadReady?callback.call(global):onReady=callback})}}(),PV.define("PV.Animate",function(settings){var setInt,self=this,progress=0,FPS=50,interval=Math.ceil(1e3/FPS),steps=Math.floor(settings.time*FPS/1e3),delta=1/steps;settings.time&&"function"==typeof settings.effect&&(setInt=setInterval(function(){settings.effect.call(self,progress.toFixed(3)),progress+=delta,progress>=1&&(settings.effect.call(self,1),"function"==typeof settings.callback&&settings.callback.call(self),clearInterval(setInt))},interval))}),PV.namespace("PV.Animate.effects"),PV.extend(PV.Animate.effects,{bounce:function(){var delta=function(progress){for(var a=0,b=1;1;a+=b,b/=2)if(progress>=(7-4*a)/11)return-Math.pow((11-6*a-11*progress)/4,2)+Math.pow(b,2)},makeEaseOut=function(delta){return function(progress){return 1-delta(1-progress)}};return makeEaseOut(delta)}}),PV.namespace("PV.Cookie"),PV.extend(PV.Cookie,{set:function(name,value,expdays,path,domain,secure){var cookie_string,expdate;cookie_string=name+"="+escape(value),expdays&&(expdate=new Date,expdate.setTime(expdate.getTime()+1e3*60*60*24*expdays),cookie_string+="; expires="+expdate.toGMTString()),path&&(cookie_string+="; path="+escape(path)),domain&&(cookie_string+="; domain="+escape(domain)),secure&&(cookie_string+="; secure"),document.cookie=cookie_string},get:function(name){var results=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");return results?unescape(results[2]):null},remove:function(name){var expdate=new Date;expdate.setTime(expdate.getTime()-1),document.cookie=name+"=; expires="+expdate.toGMTString()}}),function(PV){var global=this;PV.namespace("PV.Dom"),PV.extend(PV.Dom,{Grid:function(settings){var callback,dom,self=this,rendered=!1,cache={},allow=!0,structure={},head={},create=function(data){var node,structure={item:{tag:"li",properties:{onclick:function(){self.update(cache,!0),callback instanceof Function&&callback.call(self,data[settings.index])}}}};return PV.each(settings.columns,function(name,options){structure[name+"_"]={tag:"span",attributes:{style:"width: "+options.width+";"},properties:{innerHTML:data[name]},parent:"item"}}),node=PV.Dom.block(structure),node.item};PV.each(settings.columns,function(i,item){head[i]={tag:"span",attributes:{style:"width: "+item.width+";"},properties:{innerHTML:item.title},parent:"head"}}),dom=PV.Dom.block(PV.extend({grid:{tag:"ul",properties:{}},head:{tag:"li",attributes:{"class":"grid-head"},parent:"grid"}},head)),dom.grid.onmouseover=function(){var _onblur=global.onblur;allow=!1,global.onblur=dom.grid.onmouseout=function(){allow=!0,global.onblur=_onblur}},this.update=function(data,flag){var new_structure={};return(flag||allow===!0)&&(PV.each(data,function(i,item){new_structure[item[settings.index]]=structure[item[settings.index]]?structure[item[settings.index]]:create(item)}),PV.each(structure,function(i,v){dom.grid.removeChild(v)}),structure=new_structure,PV.each(structure,function(i,v){dom.grid.appendChild(v)})),flag||(cache=data),self},this.click=function(onclick){return callback=onclick,self},this.allow=function(){allow=!0},this.renderTo=function(parent){return rendered||dom.renderTo(parent),self},this.remove=function(){return rendered&&dom.remove(),self}}})}(PV),function(PV){var global=this;PV.namespace("PV.Dom"),PV.extend(PV.Dom,{Slider:function(options){var dom,callback,self=this,rendered=!1,structure={},section=(100/(options.length-1)).toFixed(2);structure.area={tag:"div",attributes:{"class":"slider-area"}},structure.runner={tag:"div",attributes:{"class":"slider-runner"}},PV.each(options,function(i,item){structure["section"+item]={tag:"div",attributes:{"class":"slider-section",style:"left: "+i*section+"%"},properties:{innerHTML:"<label>"+item+"</label>"},transform:i*section}},this);var getPercent=function(em,left,width){var em_left=Math.round(100*((em.clientX-left)/width));return 0>em_left?0:em_left>100?100:em_left},getNearest=function(percent){return options[Math.round(percent/section)]};dom=PV.Dom.block(structure),this.renderTo=function(parent){return rendered||(dom.renderTo(parent),parent.onmousedown=parent.ontouchstart=function(e){var _onmousemove=global.onmousemove,_onblur=global.onblur,_onmouseup=global.onmouseup,_ontouchmove=global.ontouchmove,_ontouchend=global.ontouchend,_ontouchclose=global.ontouchclose;e.touches&&(e.clientX=e.touches[0].clientX);for(var width=parent.offsetWidth,target=parent,left=0;target;)left+=parseInt(target.offsetLeft),target=target.offsetParent;dom.runner.style.left=""+getPercent(e,left,width)+"%",global.onmousemove=global.ontouchmove=function(em){em.touches&&(em.clientX=em.touches[0].clientX),dom.runner.style.left=""+getPercent(em,left,width)+"%"},global.onblur=global.onmouseup=function(em){var percent=getPercent(em,left,width),value=getNearest(percent);dom.runner.style.left=""+getPercent(em,left,width)+"%",parent.onmousemove=function(){},self.set(value),callback instanceof Function&&callback.call(self,value),global.onmousemove=_onmousemove,global.onblur=_onblur,global.onmouseup=_onmouseup,global.ontouchmove=_ontouchmove,global.ontouchend=_ontouchend,global.ontouchclose=_ontouchclose},e.preventDefault(),e.stopPropagation()},rendered=!0),self},this.remove=function(){return rendered&&dom.remove(),self},this.change=function(onchange){return callback=onchange,self},this.set=function(value){return structure["section"+value]&&(dom.runner.style.left=""+structure["section"+value].transform+"%"),self}}})}(PV),PV.namespace("PV.Dom"),PV.extend(PV.Dom,{Switch:function(options){var dom,callback,self=this,rendered=!1,structure={};PV.each(options,function(i,item){structure["option"+i]={tag:"li",properties:{innerHTML:item,onclick:function(){self.select(i),callback instanceof Function&&callback.call(self,i)},onmousedown:function(e){e.preventDefault(),e.stopPropagation()}}}},this),dom=PV.Dom.block(structure),this.renderTo=function(parent){rendered||(dom.renderTo(parent),rendered=!0)},this.remove=function(){rendered&&dom.remove()},this.reset=function(){PV.each(options,function(i){dom["option"+i].removeAttribute("class")},self)},this.select=function(num){dom["option"+num]&&(self.reset(),dom["option"+num].setAttribute("class","active"))},this.click=function(onclick){callback=onclick}}}),function(PV){var global=this;PV.namespace("PV.Dom"),PV.extend(PV.Dom,{title:function(text){document.title?document.title=text:document.getElementsByTagName("title")[0].innerHTML=text},css:function(url){var link=PV.Dom.element("link",{href:url+(url.match(/\?/)?"&":"?")+"v="+PV.config.version,rel:"stylesheet",media:"all"}),head=document.head||document.getElementsByTagName("head")[0];return{link:link,render:function(callback,context){var success=!1,timeout=setTimeout(function(){clearTimeout(timeout),success||(success=!0,callback instanceof Function&&callback.call(context||global))},1e3);head.appendChild(link),link.onload=link.onreadystatechange=function(){link.onload=link.onreadystatechange=null,success||(success=!0,callback instanceof Function&&callback.call(context||global))}},remove:function(){link.parentNode===head&&head.removeChild(link)}}},element:function(tagName,attributes,properties){var element=document.createElement(tagName);return attributes instanceof Object&&PV.each(attributes,function(name,value){element.setAttribute(name,value)},this),properties instanceof Object&&PV.each(properties,function(name,value){element[name]=value},this),element},block:function(elements){var parent,items={},here=this,main={},fragment=document.createDocumentFragment();return PV.each(elements,function(name,options){items[name]=PV.Dom.element(options.tag,options.attributes,options.properties)},this),PV.each(elements,function(name,options){var parent=fragment;"string"==typeof options.parent&&"object"==typeof items[options.parent]?parent=items[options.parent]:main[name]=items[name],parent.appendChild(items[name])},this),items.renderTo=function(node){node.appendChild(fragment),parent=node},items.remove=function(){"object"==typeof parent&&PV.each(main,function(name,element){parent.removeChild(element)},here)},items}})}(PV),function(PV){var global=this;PV.define("PV.Drag",function(block,drag,parent,step,opacity){var opacityStart,coords={},position={},move=function(e){var deltaX=e.clientX-coords.x,deltaY=e.clientY-coords.y;block.style.left=position.x+deltaX+"px",block.style.top=position.y+deltaY+"px"};parent=parent||document.body||document.getElementsByTagName("body")[0],step=step||3,opacity=opacity?parseFloat(opacity):1,drag.onmousedown=function(e){var count=0;coords.x=e.clientX,coords.y=e.clientY,position.x=block.offsetLeft,position.y=block.offsetTop,opacityStart=block.style.opacity?parseFloat(block.style.opacity):1,block.style.opacity=opacity,parent.style.cursor="move",global.onmousemove=function(e){count++,count>=step&&(count=0,move(e)),e.preventDefault(),e.stopPropagation()},global.onblur=global.onmouseup=function(){parent.style.cursor="auto",global.onmousemove=global.onblur=global.onmouseup=null,block.style.opacity=opacityStart,e.preventDefault(),e.stopPropagation()},e.preventDefault(),e.stopPropagation()}})}(PV),function(PV){var global=this,xhr=function(){return"XMLHttpRequest"in global?function(){return new global.XMLHttpRequest}:"ActiveXObject"in global?function(){var request;try{request=new global.ActiveXObject("Microsoft.XMLHTTP")}catch(e){try{request=new global.ActiveXObject("Msxml2.XMLHTTP")}catch(ee){}}return request}:function(){}}(),Handlers=function(){self=this,this.success=function(callback){return self.success_callback=callback,self},this.error=function(callback){return self.error_callback=callback,self}};PV.namespace("PV.Http"),PV.extend(PV.Http,{xhr:function(){return xhr()},get:function(url){var handler=new Handlers,request=xhr();return request.open("GET",url),request.send(),request.onreadystatechange=function(){4===request.readyState&&(200===request.status?handler.success_callback instanceof Function&&handler.success_callback.call(this,request.responseText,request.status):handler.success_callback instanceof Function&&handler.success_callback.call(this,request.responseText,request.status))},handler}})}(PV),function(PV){var global=this;PV.namespace("PV.Language"),PV.extend(PV.Language,{identify:function(){var prelang,langHash={},cookieLanguage=PV.Cookie.get("language");if(cookieLanguage)prelang=cookieLanguage.split("-")[0];else{var browserLanguage=!!global.navigator&&(global.navigator.language||global.navigator.browserLanguage);browserLanguage&&(prelang=browserLanguage.split("-")[0])}PV.each(PV.config.languages,function(i,lang){langHash[lang]=i}),prelang in langHash?PV.config.lang=prelang:PV.config.languages[0]&&(PV.config.lang=PV.config.languages[0])},set:function(lang){PV.Cookie.set("language",lang,30),window.location.reload()},get:function(){return PV.config.lang}})}(PV),function(PV){var global=this;PV.define("PV.Resize",function(block,resizer,resizeble,parent,step,opacity,callback){var opacityStart,coords={},size={},resize=function(e){var deltaX=e.clientX-coords.x,deltaY=e.clientY-coords.y;resizeble.style.width=size.x+deltaX+"px",resizeble.style.height=size.y+deltaY+"px",callback instanceof Function&&callback.call(global,size.x+deltaX,size.y+deltaY)};parent=parent||document.body||document.getElementsByTagName("body")[0],step=step||3,opacity=opacity?parseFloat(opacity):1,resizer.onmousedown=function(e){var count=0;coords.x=e.clientX,coords.y=e.clientY,size.x=resizeble.clientWidth,size.y=resizeble.clientHeight,opacityStart=block.style.opacity?parseFloat(block.style.opacity):1,block.style.opacity=opacity,parent.style.cursor="se-resize",global.onmousemove=function(e){count++,count>=step&&(count=0,resize(e)),e.preventDefault(),e.stopPropagation()},global.onblur=global.onmouseup=function(){parent.style.cursor="auto",global.onmousemove=global.onblur=global.onmouseup=null,block.style.opacity=opacityStart,e.preventDefault(),e.stopPropagation()},e.preventDefault(),e.stopPropagation()}})}(PV),PV.define("PV.Template",function(html,context){context=context||this,html=context.getText instanceof Function?html.replace(/{{(.*)}}/gi,function(placeholder,key){return context.getText(key)}):html.replace(/{{(.*)}}/gi,"");var Template=function(html){var i,self=this,parent=!1,collection=[],element=document.createElement("element"),getNodes=function(parent){var i,name;for(i=0;i<parent.children.length;i++)"getAttribute"in parent.children[i]&&(name=parent.children[i].getAttribute("pv"),null!==name&&(self[name]=parent.children[i],self[name].removeAttribute("pv"))),getNodes(parent.children[i])};for(element.innerHTML=html,getNodes(element),i=0;i<element.children.length;i++)collection.push(element.children[i]);for(i=element.children.length-1;i>=0;i--)element.removeChild(element.children[i]);this.clone=function(name){var element=document.createElement("element");return self[name]&&"innerHTML"in self[name]?(element.innerHTML=self[name].outerHTML,element.children[0]):null},this.renderTo=function(node){parent||(parent=node,parent&&PV.each(collection,function(i,item){parent.appendChild(item)}))},this.remove=function(){parent&&(PV.each(collection,function(i,item){parent.removeChild(item)}),parent=!1)}};return new Template(html)}),function(PV){var global=this,WS=function(server){var socket,events=new PV.Events;"WebSocket"in global&&(socket=new WebSocket(server),socket.onopen=function(){events.trigger("connect"),socket.onmessage=function(data){events.trigger("message",data.data)}},socket.onclose=function(){events.trigger("disconnect")}),this.on=events.on,this.emit=function(data){socket.send(data)},this.close=function(){socket.close()}};PV.define("PV.WebSocket",function(server){return new WS(server)})}(PV);